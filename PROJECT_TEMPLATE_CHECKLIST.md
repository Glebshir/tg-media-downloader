# PROJECT TEMPLATE CHECKLIST

Используй этот файл как шаблон для каждого нового Telegram-бота.
Скопируй в новый проект и отмечай пункты по мере выполнения.

## 1) Идея и границы

- [ ] Описал цель проекта в 2-3 предложениях
- [ ] Определил минимальный MVP (что обязательно должно работать)
- [ ] Определил критерий готовности (Definition of Done)

## 2) Создание проекта локально

- [ ] Создал папку проекта
- [ ] Создал базовые файлы:
  - [ ] `README.md`
  - [ ] `.gitignore`
  - [ ] `.env.example`
  - [ ] `requirements.txt`
  - [ ] `Dockerfile`
- [ ] Создал структуру кода:
  - [ ] `bot/main.py`
  - [ ] `bot/config.py`
  - [ ] `bot/handlers/`
  - [ ] `bot/services/`
  - [ ] `bot/utils/`

## 3) Git и GitHub

- [ ] Инициализировал git-репозиторий
- [ ] Создал репозиторий на GitHub
- [ ] Настроил `origin` без токена в URL
- [ ] Сделал первый commit и push в `main`
- [ ] Проверил, что `.env` не попадает в git

## 4) Конфигурация и секреты

- [ ] Вынес все чувствительные данные в env-переменные
- [ ] В `.env.example` добавил шаблоны переменных без реальных значений
- [ ] Локально создал `.env` с реальными значениями
- [ ] Убедился, что токены нигде не захардкожены

## 5) Локальный MVP

- [ ] Бот запускается локально без ошибок
- [ ] Команда `/start` работает
- [ ] Основной сценарий (например скачивание по ссылке) работает
- [ ] Ошибки обрабатываются (невалидная ссылка, недоступный ресурс)

## 6) Docker

- [ ] Docker-образ собирается локально (`docker build`)
- [ ] Контейнер запускается и бот работает в контейнере
- [ ] Переменные окружения читаются корректно внутри контейнера

## 7) GitHub Actions (CI/CD)

- [ ] Создан workflow в `.github/workflows/deploy.yml`
- [ ] Workflow собирает Docker-образ
- [ ] Workflow пушит образ в GHCR
- [ ] Workflow (опционально) дергает webhook Coolify
- [ ] Последний run в Actions зеленый

## 8) Coolify деплой

- [ ] Выбран правильный поток деплоя:
  - [ ] `GitHub Actions` собирает и пушит образ в GHCR
  - [ ] `Coolify` только тянет готовый образ и запускает контейнер
- [ ] Создано приложение в Coolify
- [ ] Проверен `Build Pack`:
  - [ ] Если есть вариант `Docker Image` -> выбрать его
  - [ ] Если `Docker Image` нет -> выбрать `Docker Compose`
- [ ] Для `Docker Compose`:
  - [ ] В репозитории есть `docker-compose.yaml` (или корректно указан `.yml`)
  - [ ] В Coolify указан правильный путь к compose-файлу (`/docker-compose.yaml` или `/docker-compose.yml`)
  - [ ] В compose используется `image: ghcr.io/<user>/<repo>:latest`, а не `build: .`
- [ ] Настроены переменные окружения в Coolify:
  - [ ] `BOT_TOKEN`
  - [ ] `MAX_FILE_SIZE`
  - [ ] другие нужные переменные
- [ ] Добавлены registry credentials для GHCR (если GHCR приватный):
  - [ ] Registry: `ghcr.io`
  - [ ] Username: GitHub username
  - [ ] Token: PAT с `read:packages` (для pull)
- [ ] Выполнен redeploy
- [ ] Логи запуска без критических ошибок
- [ ] Бот отвечает в Telegram после деплоя

## 8.1) Анти-ошибки Coolify (обязательно проверить)

- [ ] Нет двойного тега образа (ошибка вида `invalid tag ...:latest:<sha>`)
- [ ] Coolify не пытается `docker push` в GHCR без прав (ошибка `unauthorized: unauthenticated`)
- [ ] Путь к compose-файлу совпадает с реальным именем (`.yaml` vs `.yml`)
- [ ] В рантайме не возникает `BOT_TOKEN not set`

## 9) Telegram bot token

- [ ] Создан бот через `@BotFather`
- [ ] Получен токен
- [ ] Токен добавлен в Coolify (`BOT_TOKEN`)
- [ ] После redeploy бот отвечает в Telegram

## 10) Тестирование перед релизом

- [ ] Smoke test YouTube-ссылки
- [ ] Smoke test Instagram-ссылки
- [ ] Тест на невалидную ссылку
- [ ] Тест на большой файл (ограничение размера)
- [ ] Проверен cleanup временных файлов

## 11) Документация проекта

- [ ] `README.md` содержит:
  - [ ] описание проекта
  - [ ] как запускать локально
  - [ ] как деплоить
  - [ ] какие env-переменные нужны
- [ ] Создан статус-файл с текущим состоянием, например:
  - [ ] `PROJECT_STATUS_YYYY-MM-DD.md`

## 12) Безопасность (обязательно)

- [ ] Токены не в коде и не в git history
- [ ] Токены не в `git remote -v`
- [ ] Секреты GitHub хранятся в `Settings -> Secrets and variables -> Actions`
- [ ] При утечке токена: отозвал/пересоздал сразу

## Быстрая шпаргалка по терминам

- `GitHub Actions`: автоматические пайплайны (сборка, тесты, деплой) из `.github/workflows/*.yml`.
- `GitHub Apps`: интеграции с GitHub на уровне приложения/прав доступа (обычно не нужны для простого деплоя бота).
- `Coolify`: сервис, который подтягивает образ/код и запускает приложение на сервере.

## Шаблон переменных для `.env.example`

```env
BOT_TOKEN=
MAX_FILE_SIZE=52428800
```
